<!doctype html>

<html lang="en-us">

    <head>
        <meta charset="utf-8">
        
        <title>Music Server Revisited: Streaming with sshfs and mp3fs - Zach Denton</title>
        
        <meta name="author" content="Zach Denton">
        <meta name="description" content="Access a remote music collection seamlessly with user-space filesystems.">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Share+Tech:400">
        <link rel="stylesheet" href="../css/main.css">
        
        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-15976986-5', 'auto');ga('send', 'pageview');</script>
    </head>
    
    <body>
    
        <div id="banner"></div>
        <header id="header" role="banner">
            <h1><a href="../">Zach Denton</a></h1>
            <nav>
            <ul>
                <li><a href="../about/">About</a></li>
                <li><a href="../archives/">Blog</a></li>
                <li><a href="../project-euler-solutions/">Euler</a></li>
                <li><a href="https://github.com/zacharydenton">GitHub</a></li>
                <li><a href="../resume.pdf">Resume</a></li>
            </ul>
            </nav>
        </header>
        <article>
  <h1>Music Server Revisited: Streaming with sshfs and mp3fs</h1>

  <p>A while back, I wrote about <a href="../build-a-media-server-with-ampache-and-transmission/">streaming music with Ampache</a>. Ampache is a nice piece of software, with some unique advantages (like Android support). However, there are simpler ways to stream music. I’m going to show you how to stream music using sshfs and (optionally) mp3fs. One of the best things about this approach is that it allows you to access your collection with the media player of your choice.</p>
<p>Before you start, you’re going to need a Linux machine with your music collection on it (the server). You will also need another Linux machine to act as the client (e.g. a laptop with a small hard drive).</p>
<h2 id="configuring-the-server">Configuring the server</h2>
<h3 id="install-the-ssh-server">Install the ssh server</h3>
<p>The first thing you’re going to want to do is install an ssh server, if it’s not already installed.</p>
<pre><code>$ sudo aptitude install openssh-server</code></pre>
<p>If your music is already compressed, or if you just have a very fast internet connection, you’re done configuring the server. Otherwise, read on to learn how to transcode your music on-the-fly with mp3fs.</p>
<h3 id="set-up-mp3fs">Set up mp3fs</h3>
<blockquote>
<p>MP3FS is a read-only FUSE filesystem which transcodes audio formats (currently FLAC) to MP3 on the fly when opened and read. This was written to enable me to use my FLAC collection with software and/or hardware which only understands the MP3 format e.g. gmediaserver to a Netgear MP101 MP3 player. — <a href="http://khenriks.github.com/mp3fs/">Kristofer Henriksson</a></p>
</blockquote>
<p>If you have any music in FLAC format, you’re probably not going to be able to stream it without first transcoding to MP3. mp3fs solves this problem. First, install it.</p>
<pre><code>$ sudo aptitude install mp3fs</code></pre>
<p>NOTE: Depending on your distro, the repositories might have an outdated version of mp3fs. If the following commands don’t work, try installing a newer version of mp3fs (either by compiling it yourself or finding a newer package).</p>
<p>Now that it’s installed, we’ll set it up. Create a folder for the mp3fs:</p>
<pre><code>$ mkdir ~/MP3</code></pre>
<p>Next, add an entry to <code>/etc/fstab</code> to automatically mount the mp3fs:</p>
<pre><code># cat &gt;&gt; /etc/fstab &lt;&lt; EOF
mp3fs#/home/USER/Music /home/USER/MP3 fuse allow_other,ro,bitrate=320 0 0
EOF</code></pre>
<p>Make sure you adjust the paths and bitrate, if necessary.</p>
<p>Finally, mount the mp3fs:</p>
<pre><code>$ sudo mount -a</code></pre>
<p>Now your music collection should appear at <code>~/MP3</code> in MP3 format.</p>
<h2 id="configuring-the-client">Configuring the client</h2>
<p>We’re going to use sshfs to stream the music. It uses SSH to allow you to mount remote filesystems on the local machine. In other words, it will make your remote music collection available on the client machine. To start, install sshfs.</p>
<pre><code>$ sudo aptitude install sshfs</code></pre>
<p>Now, mount the remote music collection (adjust the parameters as necessary):</p>
<pre><code>$ sshfs USER@example.com:Music ~/Music</code></pre>
<p>Your music collection should now be visible on the client at <code>~/Music</code>. Fire up your favorite media player, allow it to scan your music library, and enjoy.</p>
<p>If you want the sshfs to be automatically mounted, you will first need to <a href="http://www.ece.uci.edu/~chou/ssh-key.html">set up key-based SSH authentication</a>. Once that’s done, you will need to edit <code>/etc/fstab</code>:</p>
<pre><code># cat &gt;&gt; /etc/fstab &lt;&lt; EOF
sshfs#USER@example.com:Music /home/USER/Music fuse defaults,idmap=user 0 0
EOF</code></pre>
<p>Now your music collection will be available at login.</p>
</article>

        <script src="../js/main.js"></script>
    </body>
</html>
